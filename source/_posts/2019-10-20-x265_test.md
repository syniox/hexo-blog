---
layout: post
title: x265参数小试
---

关于x265，想要最佳性价比 ~~请直接medium~~

~~众所周知~~，x265的默认参数设定比起x264显得不尽人意（至少在某些方面上）。
大众的电脑通常会出现一个很尴尬的问题就是slower太慢slow太快（slow速度是slower的4倍左右）。
在这里给出一些数据，还有我自己的调整的preset。（只在720p下测试）
这些并不能说优秀，只能说是一个折中的选择吧。。
基本测试集只有3个（但动-静，真人-游戏都有）。有一些没测完只能当结论用。。
rect和amp两大玄学参数我到现在都还没搞明白规律。。
版本： 3.2


```
x265 --y4m - --preset slower --no-amp --cbqpoffs -1 --crqpoffs -1 \
    --limit-refs=3 --rd=4 --rc-lookahead=60 \
    --no-open-gop --merange 44 --crf 26 -o out.hevc
```

参数是累加的。后面的选项计算速度增幅时前面的选项都是调整后的。BD-Rate用psnr计算。
amp(on->off): 压缩率变化小于0.2%。关闭的速度提升在8% ~ 20%。但是偶尔会有一两个clip没有速度提升（？？？）
limit-refs(1->3)：速度是原来的 140% ~ 150%，码率增加 0.7% ~ 0.9%
rd(6->4)：速度是原来的 200% ~ 220%，码率增加 0.6% ~ 4%
rc-lookahead(40->60)码率减少-0.1%（没看错） ~ 0.3%，不过反正不影响速度又不缺内存也无所谓。

merange算是一个讨论点吧（虽然我觉得速度根本变不了多少）
有些论坛上的人大胆地把它从57调到25，2333
自已也测试了一下,速度正表示提升。
- Range - | - Speed - | - BD-Rate -
:-:|:-:|:-:
25 | +7.46% | +0.74%
38 | +4.55% | +0.32%
44 | +3.36% | +0.13%
可以看见调到44时的speed-quality的trade-off还说得过去
但调到38时就已经降得很厉害了

wpp（不在参数中）: 优化多线程，增加多核CPU占用率
之前在awcy上经常看见x265编码的时候要加--no-wpp，在本地测试了一下。
不开wpp比开wpp有1% ~ 2%的码率节省。
但是本地测的单线程速度完全一样，完全不像awcy那样达到50% ~ 70%的速度提升。

本来在加上这些以后还想加一个众所周知的--no-rect，做了一下测试：
速度增加20% ~ 27%，码率增加2% ~ 3.7%
感觉性价比甚至不如merange，所以最后就没加。。

累加起来大概就是这样了(与两个preset对比)：
- Preset - | - Speed - | - BD-Rate -
:-:|:-:|:-:
slower| 341% | +2.85%
slow| 79% | -3.41%
